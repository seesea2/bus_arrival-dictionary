{"version":3,"sources":["webpack:///./src/common/busBookmarks.js","webpack:///./src/views/BusArrivalTime.vue","webpack:///./src/views/BusArrivalTime.vue?b4da"],"names":["add","busStop","get","BusStopCode","bookmarks","getAll","push","localStorage","setItem","JSON","stringify","err","console","log","busStopCode","find","item","storageStr","getItem","parse","remove","filter","document","title","data","reactive","inputCode","busArrival","loading","loadingNote","bookmark","refresh","axios","then","resp","catch","response","message","getLoadColour","bus","Load","calculateArrivalTime","EstimatedArrival","date","Date","valueOf","now","diffMinutes","toFixed","addBookmark","onBeforeMount","route","useRoute","params","__exports__"],"mappings":"gHAAA,SAASA,EAAIC,GACX,IACE,GAAIC,EAAID,EAAQE,aACd,OAAO,EAGT,IAAIC,EAAYC,IAIhB,OAHAD,EAAUE,KAAKL,GACfM,aAAaC,QAAQ,mBAAoBC,KAAKC,UAAUN,KAEjD,EACP,MAAOO,GAGP,OADAC,QAAQC,IAAIF,IACL,GAIX,SAAST,EAAIY,GACX,IACE,IAAIV,EAAYC,IAChB,OAAOD,EAAUW,KAAMC,GAASA,EAAKb,cAAgBW,GACrD,MACA,QAIJ,SAAST,IACP,IACE,MAAMY,EAAaV,aAAaW,QAAQ,oBACxC,IAAId,EAAY,GAIhB,OAHIa,IACFb,EAAYK,KAAKU,MAAMF,IAElBb,EACP,MACA,MAAO,IAIX,SAASgB,EAAON,GACd,IACE,IAAIV,EAAYC,IAGhB,OAFAD,EAAYA,EAAUiB,OAAQL,GAASA,EAAKb,cAAgBW,GAC5DP,aAAaC,QAAQ,mBAAoBC,KAAKC,UAAUN,KACjD,EACP,MACA,OAAO,GA/CX,yI,ojCCuFAkB,SAASC,MAAQ,cACjB,IAAIC,EAAOC,eAAS,CAClBC,UAAW,KACXC,WAAY,KACZ1B,QAAS,KACT2B,QAAS,KACTC,YAAa,KACbC,SAAU,OASZ,SAASC,IACPP,EAAKI,SAAU,EACfJ,EAAKK,YAAc,GACnBG,IACG9B,IAAI,2BAA6BsB,EAAKE,WACtCO,KAAMC,IACLV,EAAKvB,QAAUiC,EAAKV,KAAKvB,QACzBuB,EAAKG,WAAaO,EAAKV,KAAKG,WAE5BH,EAAKM,SAAW5B,eAAIsB,EAAKE,aAE1BS,MAAOxB,IACFA,EAAIyB,UAAYzB,EAAIyB,SAASZ,MAAQb,EAAIyB,SAASZ,KAAKa,QACzDb,EAAKK,YAAclB,EAAIyB,SAASZ,KAAKa,QAGvCb,EAAKK,YAAclB,IAEpBsB,KAAK,KACJT,EAAKI,SAAU,IAIrB,SAASU,EAAcC,GACrB,GAAKA,GAAmB,OAAZA,EAAIC,KAET,MAAgB,OAAZD,EAAIC,KACN,UACc,OAAZD,EAAIC,KACN,kBADF,EAKT,SAASC,EAAqBF,GAC5B,IAAKA,IAAQA,EAAIG,iBACf,MAAO,KAGT,MAAMC,EAAO,IAAIC,KAAKL,EAAIG,kBAC1B,GAAIC,EAAKE,UAAYD,KAAKE,MAAQ,EAChC,MAAO,UAET,MAAMC,GAAeJ,EAAKE,UAAYD,KAAKE,OAAS,IAAO,GAC3D,OAAIC,EAAc,EACT,QAEAA,EAAYC,QAAQ,GAAK,QAGpC,SAASC,IAEHjD,eAAIwB,EAAKvB,WACXuB,EAAKM,SAAW5B,eAAIsB,EAAKE,Y,OA1D7BwB,eAAc,KACZ,MAAMC,EAAQC,iBACd5B,EAAKE,UAAYyB,EAAME,OAAO3B,UAC9BK,M,i0DCjGF,MAAMuB,EAAc,EAEL","file":"js/chunk-5f1a95a6.bc1b8530.js","sourcesContent":["function add(busStop) {\r\n  try {\r\n    if (get(busStop.BusStopCode)) {\r\n      return false;\r\n    }\r\n\r\n    let bookmarks = getAll();\r\n    bookmarks.push(busStop);\r\n    localStorage.setItem(\"busStopBookmarks\", JSON.stringify(bookmarks));\r\n    // console.log(\"add true\");\r\n    return true;\r\n  } catch (err) {\r\n    // console.log(\"add false\");\r\n    console.log(err);\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction get(busStopCode) {\r\n  try {\r\n    let bookmarks = getAll();\r\n    return bookmarks.find((item) => item.BusStopCode === busStopCode);\r\n  } catch {\r\n    return;\r\n  }\r\n}\r\n\r\nfunction getAll() {\r\n  try {\r\n    const storageStr = localStorage.getItem(\"busStopBookmarks\");\r\n    let bookmarks = [];\r\n    if (storageStr) {\r\n      bookmarks = JSON.parse(storageStr);\r\n    }\r\n    return bookmarks;\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction remove(busStopCode) {\r\n  try {\r\n    let bookmarks = getAll();\r\n    bookmarks = bookmarks.filter((item) => item.BusStopCode !== busStopCode);\r\n    localStorage.setItem(\"busStopBookmarks\", JSON.stringify(bookmarks));\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport { add, get, getAll, remove };\r\n","<template>\r\n  <div class=\"container text-center py-3\">\r\n    <div>\r\n      <h3 v-if=\"data.busStop\">{{ data.busStop.Description }}</h3>\r\n      <h5>Bus Stop: {{ data.inputCode }}</h5>\r\n\r\n      <div v-if=\"data.loading\" class=\"my-3\">\r\n        <div\r\n          class=\"spinner-border\"\r\n          style=\"width: 10rem; height: 10rem\"\r\n          role=\"status\"\r\n        >\r\n          <span class=\"sr-only\">Loading...</span>\r\n        </div>\r\n      </div>\r\n      <div v-else-if=\"data.loadingNote\">{{ data.loadingNote }}</div>\r\n    </div>\r\n\r\n    <table v-if=\"data.busArrival\" class=\"table mt-3\">\r\n      <thead class=\"thead-dark\">\r\n        <tr>\r\n          <th scope=\"col\">#</th>\r\n          <th scope=\"col\">1st Bus</th>\r\n          <th scope=\"col\">2nd Bus</th>\r\n          <th scope=\"col\">3rd Bus</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody v-if=\"data.busArrival.Services.length\">\r\n        <tr\r\n          v-for=\"service in data.busArrival.Services\"\r\n          :key=\"service.ServiceNo\"\r\n        >\r\n          <th scope=\"row\">{{ service.ServiceNo }}</th>\r\n          <td :class=\"getLoadColour(service.NextBus)\">\r\n            {{ calculateArrivalTime(service.NextBus) }}\r\n          </td>\r\n          <td :class=\"getLoadColour(service.NextBus2)\">\r\n            {{ calculateArrivalTime(service.NextBus2) }}\r\n          </td>\r\n          <td :class=\"getLoadColour(service.NextBus2)\">\r\n            {{ calculateArrivalTime(service.NextBus3) }}\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n      <tbody v-else>\r\n        <tr>\r\n          <td v-for=\"ind in 4\" :key=\"ind\">NA</td>\r\n        </tr>\r\n      </tbody>\r\n      <caption>\r\n        <ul class=\"small\">\r\n          <li>\r\n            <label>Seats Available</label>\r\n          </li>\r\n          <li>\r\n            <label class=\"bg-info\">Standing Available</label>\r\n          </li>\r\n          <li>\r\n            <label class=\"bg-warning\">Limited Standing</label>\r\n          </li>\r\n        </ul>\r\n      </caption>\r\n    </table>\r\n\r\n    <div class=\"btn-group mt-3\">\r\n      <button v-if=\"!data.loadingNote\" @click=\"refresh\" class=\"btn btn-primary\">\r\n        Refresh\r\n      </button>\r\n      <button\r\n        v-if=\"!data.loadingNote && !data.bookmark\"\r\n        @click=\"addBookmark\"\r\n        class=\"btn btn-primary\"\r\n      >\r\n        BookmarkBusStop\r\n      </button>\r\n      <button class=\"btn btn-primary\" @click=\"$router.go(-1)\">Back</button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport axios from \"axios\";\r\nimport { onBeforeMount, reactive } from \"vue\";\r\nimport { useRoute } from \"vue-router\";\r\n\r\nimport { get, add } from \"../common/busBookmarks.js\";\r\n\r\ndocument.title = \"Bus Arrival\";\r\nlet data = reactive({\r\n  inputCode: null,\r\n  busArrival: null,\r\n  busStop: null,\r\n  loading: null,\r\n  loadingNote: null,\r\n  bookmark: null,\r\n});\r\n\r\nonBeforeMount(() => {\r\n  const route = useRoute();\r\n  data.inputCode = route.params.inputCode;\r\n  refresh();\r\n});\r\n\r\nfunction refresh() {\r\n  data.loading = true;\r\n  data.loadingNote = \"\";\r\n  axios\r\n    .get(\"/api/lta/bus/busArrival/\" + data.inputCode)\r\n    .then((resp) => {\r\n      data.busStop = resp.data.busStop;\r\n      data.busArrival = resp.data.busArrival;\r\n\r\n      data.bookmark = get(data.inputCode);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response && err.response.data && err.response.data.message) {\r\n        data.loadingNote = err.response.data.message;\r\n        return;\r\n      }\r\n      data.loadingNote = err;\r\n    })\r\n    .then(() => {\r\n      data.loading = false;\r\n    });\r\n}\r\n\r\nfunction getLoadColour(bus) {\r\n  if (!bus || bus.Load == \"SEA\") {\r\n    return;\r\n  } else if (bus.Load == \"SDA\") {\r\n    return \"bg-info\";\r\n  } else if (bus.Load == \"LSD\") {\r\n    return \"bg-warning\";\r\n  }\r\n  return;\r\n}\r\nfunction calculateArrivalTime(bus) {\r\n  if (!bus || !bus.EstimatedArrival) {\r\n    return \"NA\";\r\n  }\r\n\r\n  const date = new Date(bus.EstimatedArrival);\r\n  if (date.valueOf() - Date.now() < 0) {\r\n    return \"Arrived\";\r\n  }\r\n  const diffMinutes = (date.valueOf() - Date.now()) / 1000 / 60;\r\n  if (diffMinutes < 1) {\r\n    return \"1 min\";\r\n  } else {\r\n    return diffMinutes.toFixed(0) + \" mins\";\r\n  }\r\n}\r\nfunction addBookmark() {\r\n  // console.log(\"to add\", this.busStop);\r\n  if (add(data.busStop)) {\r\n    data.bookmark = get(data.inputCode);\r\n    // console.log(\"this.bookmark after add\", this.bookmark);\r\n  }\r\n}\r\n</script>\r\n","import script from \"./BusArrivalTime.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./BusArrivalTime.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"sourceRoot":""}